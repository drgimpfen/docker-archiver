{% extends "base.html" %}

{% block title %}Settings - Docker Archiver{% endblock %}

{% block content %}
<div class="mb-4">
    <h2><i class="bi bi-gear me-2"></i> Settings</h2>
</div>

<form method="POST">
    <!-- General Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-globe me-2"></i> General</h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="baseUrl" class="form-label">Base URL</label>
                <input type="url" class="form-control" id="baseUrl" name="base_url" 
                       value="{{ settings.get('base_url', 'http://localhost:8080') }}">
                <div class="form-text">Used for generating links in notifications</div>
            </div>
            
            <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" role="switch" 
                       id="maintenanceMode" name="maintenance_mode"
                       {% if settings.get('maintenance_mode') == 'true' %}checked{% endif %}>
                <label class="form-check-label" for="maintenanceMode">
                    <strong>Maintenance Mode</strong><br>
                    <small class="text-muted">Pauses all scheduled archives (shows banner on dashboard)</small>
                </label>
            </div>
        </div>
    </div>
    
    <!-- Notification Settings -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-bell me-2"></i> Notifications</h5>
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="appriseUrls" class="form-label">Apprise URLs</label>
                <textarea class="form-control" id="appriseUrls" name="apprise_urls" 
                          rows="5" placeholder="One URL per line&#10;discord://webhook_id/webhook_token&#10;telegram://bot_token/chat_id&#10;mailto://user:password@gmail.com">{{ settings.get('apprise_urls', '') }}</textarea>
                <div class="form-text">
                    Enter notification service URLs (one per line). See 
                    <a href="https://github.com/caronc/apprise#supported-notifications" target="_blank">Apprise documentation</a> 
                    for supported services.
                </div>
            </div>
            
            <div class="mb-3">
                <label class="form-label">Notify on:</label>
                
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="notifySuccess" name="notify_success"
                           {% if settings.get('notify_on_success') == 'true' %}checked{% endif %}>
                    <label class="form-check-label" for="notifySuccess">
                        <i class="bi bi-check-circle text-success me-1"></i> Successful job completion
                    </label>
                </div>
                
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="notifyError" name="notify_error"
                           {% if settings.get('notify_on_error') == 'true' %}checked{% endif %}>
                    <label class="form-check-label" for="notifyError">
                        <i class="bi bi-x-circle text-danger me-1"></i> Job failures
                    </label>
                </div>
            </div>
            
            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="testNotification()">
                <i class="bi bi-send me-1"></i> Send Test Notification
            </button>
        </div>
    </div>
    
    <!-- User Management (Placeholder) -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0"><i class="bi bi-people me-2"></i> Users</h5>
        </div>
        <div class="card-body">
            <p class="text-muted mb-0">
                <i class="bi bi-info-circle me-1"></i> 
                User management and role-based access control will be available in a future update.
            </p>
        </div>
    </div>
    
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">
            <i class="bi bi-check-lg me-1"></i> Save Settings
        </button>
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary">Cancel</a>
    </div>
</form>

{% endblock %}

{% block extra_js %}
<script>
function testNotification() {
    // This would trigger a test notification
    alert('Test notification functionality not yet implemented.\nCheck your Apprise URLs are correct and save settings first.');
    // TODO: Implement test notification API endpoint
}
</script>
{% endblock %}
