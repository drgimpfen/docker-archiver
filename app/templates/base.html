<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Docker Archiver</title>
    <link rel="icon" href="{{ url_for('static', filename='assets/favicon.png') }}" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='assets/docker-archiver-logo.png') }}" alt="logo" style="height:32px; width:auto; margin-right:8px; object-fit:contain;"/>
                <span>Docker Archiver</span>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                {% if session.user_id %}
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Dashboard</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('history') }}">History</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('schedules_route') }}">Schedules</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('archives_list') }}">Archives</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item d-flex align-items-center me-2">
                        <button id="theme-toggle" class="btn btn-sm btn-outline-light" title="Toggle dark mode">üåô</button>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('profile_route') }}">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('settings_route') }}">Settings</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout_route') }}">Logout</a>
                    </li>
                </ul>
                {% endif %}
            </div>
        </div>
    </nav>

    <main class="container mt-4">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}
        
        {% block content %}{% endblock %}
    </main>

    <footer class="footer mt-4 py-3">
        <div class="container text-center">
            <small class="text-muted">
                Version 0.1.0 &nbsp;‚Äî
                <a href="https://github.com/drgimpfen/Docker-Archiver/" target="_blank" rel="noopener" class="footer-link ms-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16" class="footer-icon" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8a8 8 0 005.47 7.59c.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2 .37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82a7.6 7.6 0 012-.27 7.6 7.6 0 012 .27c1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.28.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.19 0 .21.15.46.55.38A8 8 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    <span class="visually-hidden">GitHub</span>
                </a>
                <a href="https://discord.gg/Tq84tczrR2" target="_blank" rel="noopener" class="footer-link ms-3">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 71 55" fill="currentColor" class="footer-icon" aria-hidden="true">
                        <path d="M60.104 4.552A58.6 58.6 0 0046.79.7a41.03 41.03 0 00-1.96 4.04 56.23 56.23 0 00-16.66 0A41.01 41.01 0 0026.2.7 58.6 58.6 0 0012.9 4.55C3.62 19.02.63 33.3 3.04 46.41a58.19 58.19 0 0018.3 7.14c.16-.22.3-.45.45-.68-1.8-.52-3.5-1.07-5.12-1.71 1.86 1.29 4.03 2.37 6.42 3.21 9.34 3.8 17.49 3.02 26.68 0 2.36-.66 4.61-1.43 6.64-2.36-.03-.03-.06-.06-.09-.09a44.66 44.66 0 01-1.61 1.71c1.24-.43 2.45-.92 3.63-1.44 0 0 4.7-1.73 7.99-4.02a59.49 59.49 0 00-2.49-19.3c-2.68-8.76-8.24-15.12-8.24-15.12zM23.7 37.45s-2.06-2.44-3.77-4.64c6.78-1.95 9.34-6.9 9.34-6.9-2.17 1.22-3.99 1.98-3.99 1.98-3.48 1.56-6.79 1.06-9.52.53 2.04-.64 4.46-1.64 6.1-3.05-5.04-1.43-8.65-5.29-8.65-5.29 1.02.78 2.1 1.33 3.34 1.79a29.86 29.86 0 004.03 1.14c.93-.07 1.86-.16 2.79-.27-1.33-1.06-2.42-2.31-3.08-3.7 0 0 3.26 2.54 5.78 3.14a33.17 33.17 0 005.2.8c.43-.01.86-.01 1.29-.02 0 0-1.76 2.09-4.11 3.35 2.78.15 5.2.18 7.37-.08-1.7 2.17-3.73 4.66-3.73 4.66 4.96-.24 10.02-2.22 10.02-2.22s-2.15 3.49-6.6 6.34c-3.35 2.24-7.68 3.19-11.85 3.02z"/>
                    </svg>
                    <span class="visually-hidden">Discord</span>
                </a>
            </small>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Theme toggle: store preference in localStorage
        (function(){
            const toggle = document.getElementById('theme-toggle');
            const serverTheme = {{ user_theme|tojson | safe }};
            const preferred = localStorage.getItem('theme');
            // Determine initial theme: server preference -> localStorage -> OS preference -> default dark
            let isDark = false;
            if(serverTheme) {
                isDark = serverTheme === 'dark';
            } else if(preferred) {
                isDark = preferred === 'dark';
            } else if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
                isDark = true;
            } else {
                isDark = true; // default to dark
            }

            if(isDark) document.body.classList.add('dark-mode');
            if(toggle){
                toggle.textContent = document.body.classList.contains('dark-mode') ? '‚òÄÔ∏è' : 'üåô';
                toggle.addEventListener('click', function(){
                    const nowDark = document.body.classList.toggle('dark-mode');
                    localStorage.setItem('theme', nowDark ? 'dark' : 'light');
                    toggle.textContent = nowDark ? '‚òÄÔ∏è' : 'üåô';
                });
            }
        })();
    </script>
</body>
</html>
